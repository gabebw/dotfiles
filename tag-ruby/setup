#!/bin/bash

set -e

# Point Ruby at OpenSSL, which it otherwise cannot find
export RUBY_CONFIGURE_OPTS="--with-openssl-dir=$(brew --prefix openssl@3)"

latest_ruby_version(){
  mise ls-remote ruby | rg -v 'dev|preview|rc' | tail -1
}

echo "Installing latest Ruby (version $(latest_ruby_version))..."
# `mise use` installs it if it's not yet installed
mise use --global ruby@"$(latest_ruby_version)"

gem install ruby-lsp-rails
